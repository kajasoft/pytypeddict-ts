# pytypeddict-ts
### Python TypedDicts to TypeScript translator

Translate Python 3.11 TypedDict definitions into TypeScript type
definitions from the command line.

## Installation

The GHC Haskell compiler is required. To install a compatible version
of Haskell, we suggest you use [ghc-up][1]. 

[1]:https://www.haskell.org/ghcup

```
# install a recent haskell compiler
ghcup install ghc 9.2.5
ghcup install set ghc 9.2.5
cabal update
# install pytypeddict-ts in ~/.cabal/bin
cabal install
```


## Motivation

This project was inspired by [py-ts-interfaces][2], which states the
motivation perfectly:

[2]:https://github.com/Syndallic/py-to-ts-interfaces

> In web applications where Python is used in the backend and
> TypeScript is used in the frontend, it is often the case that the
> client will make calls to the backend to request some data with some
> specific pre-defined "shape".  On the client-side, an `interface`
> for this data is usually defined and if the Python backend authors
> use typechecking, like with [mypy](http://mypy-lang.org/), the
> project authors may be typing the JSON response values as well.
>
> This results in a duplication of code.  If the shape changes in the
> backend, the related interface must also be reflect its changes in
> the frontend.  At best, this is annoying to maintain.  At worst,
> over time the interfaces may diverge and cause bugs.
>
> This library aims to have a single source of truth that describes
> the shape of the payload between the backend and the frontend.

We created `pytypeddict-ts` to translate Python TypedDicts across the
Python-TypeScript boundary. `py-ts-interfaces` translates Dataclasses
to TypeScript, but not TypedDicts.


## Usage

Basic usage entails a Unix pipeline:

    cat types.py | pytypeddict-ts > types.ts

Example input `types.py`:

    TimeStamp = int

    ContentType = Literal['movie', 'series', 'season', 'episode']

    class StreamingService(TypedDict):
        link: str
        service_name: str 

    class Title(TypedDict):
        actors: list[str]
        content_type: ContentType
        genre_names: list[str]
        id: int
        image: str | None
        imdb_id: str
        imdb_rating: float | None
        imdb_vote_count: int | None
        overview: str
        runtime: NotRequired[int | None] # comment
        title: str
        year: int | None
        streaming_services: list[StreamingService]
        added_to_streaming: TimeStamp | None

Output `types.ts`:

    export type TimeStamp = number;

    export type ContentType = "movie" | "series" | "season" | "episode";

    export type StreamingService = {
      link: string;
      service_name: string;
    };

    export type Title = {
      actors: Array<string>;
      content_type: ContentType;
      genre_names: Array<string>;
      id: number;
      image: string | null;
      imdb_id: string;
      imdb_rating: number | null;
      imdb_vote_count: number | null;
      overview: string;
      runtime?: number | null;
      title: string;
      year: number | null;
      streaming_services: Array<StreamingService>;
      added_to_streaming: TimeStamp | null;
    };

In practice, we only want to take select TypeDict definitions from our
Python module and translate them into a complete TypeScript module
file. In this case, we write more elaborate shell logic to achieve
this with tools like `sed`, e.g.,

    echo '// This file is generated by pytypeddict-ts'

    sed -n '/^ContentType/ p' ./app/types.py | pytypeddict-ts
    sed -n '/^TimeStamp/ p' ./app/types.py | pytypeddict-ts

    sed -n '/^class ServiceInfo/,/^ *$/ p' ./app/types.py | pytypeddict-ts
    sed -n '/^class TitleDict/,/^ *$/ p' ./app/types.py | pytypeddict-ts



## License

MIT License
